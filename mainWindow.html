<!DOCTYPE html>
<html lang="en">

<head>

  <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src
       see above for hashing specific scripts
       TODO - for now using unsafe-inline -- eventually may want to secure this
       with specifics
       TODO - may want to inject these into session instead per Electron guide
  -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src
      'self'
      'unsafe-inline'
      https://jquery.com/
      https://code.jquery.com/
      https://cdnjs.cloudflare.com/
      https://fonts.googleapis.com/
      https://fonts.gstatic.com/
      https://d3js.org ">
  </meta>

  <title>Viffy</title>

  <!-- https://stackoverflow.com/questions/32621988/electron-jquery-is-not-defined -->
  <!-- Insert this line above script imports  -->
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

  <script
	  src="https://code.jquery.com/jquery-3.3.1.min.js"
	  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	  crossorigin="anonymous">
  </script>

  <!-- Materialize -->
  <!-- Materialize CDNs -->
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- End Materialize -->

  <!-- Plotting / Charting / Data Visualization
       v3 to keep the refs to d3.scale.linear()
       v5 will start using eg d3.scaleLinear -->
  <script src="https://d3js.org/d3.v3.min.js"></script>

  <link rel="stylesheet" href="css/custom.css">

  <!-- Paired with pre-script line - to allow same code for electron app and
       browser-based implementations in theory -->
  <!-- Insert this line after script imports -->
  <script>if (window.module) module = window.module;</script>

</head>



<body>
  <header></header>



  <!--
  ******************************************************************************
          MAIN
  ******************************************************************************
  -->

  <main>

    <nav>
      <div class="nav-wrapper">
        <a href="" class="brand-logo center">Viffy</a>
      </div>
    </nav>

    <ul></ul>

    <div id="error"></div>
    <div id="ports"></div>

    <div id="ports-info">
      <p>Note: These are serial ports returned by serialport which means that
        your device would be listed here if is intended to enumerate as a serial
        port, real or virtual.  For example, using the FTDI VCP driver.
      </p>
      <p>
        However, if your device is intended to be accessed as an FTDO D2XX driver
        device target, then you should/will not see it in this listing until
        the d2xx device listing is added to this code.  You can still click SELECTME
        at any serial device here and you'll then see the buttons to test access to the
        first detected d2xx FTDI device.
      </p>
    </div>

    <div id="activeSerialPortStuff" style="display:none;">
      <h6>Active (Selected) Serial Port: </h6>
      <span id="activePort"></span>
      <span id="serialOpenBtnSpan"><button name="serialOpenBtn" id="serialOpenBtn" onclick="serialOpen()">Open</button></span>
      <span id="serialCloseBtnSpan"><button name="serialCloseBtn" id="serialCloseBtn" onclick="serialClose()">Close</button></span>
      <span id="serialTestWriteSpan"><button name="serialTestWrite" id="serialTestWrite" onclick="serialTestWrite()">Test Write</button></span>
    </div>

    <!-- .......................................... --><!--
    ***********************************************
      CARD - Chart
    *********************************************** -->
    <div class="row">
      <div class="col s12"><!-- was col s12 m7 -->
        <div class="card blue-grey darken-1">
          <div class="card-content white-text">
            <span class="card-title">
              <span class="chart-title">Chart Title</span>
            </span>
            <div id="chart"></div>
            <div class="card-action">
              <a href="#">Link</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- .......................................... --><!--
    ***********************************************
      CARD - Output console-like
    *********************************************** -->
    <div class="row"><div class="col s12">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text">
            <span class="card-title">
              <span class="output-title">Output</span>
            </span>
            <div id="output">
              <pre class="preserve-whitespace pre-scrollable">
                <span id="output">Output log</span>
              </pre>
            </div>
            <div class="card-action">
              <a href="#">Link</a>
            </div>
          </div>
        </div>
    </div></div>

  </main><!-- main -->




  <!--
  ******************************************************************************
          NAVIGATION
  ******************************************************************************
  -->

  <!--https://materializecss.com/sidenav.html -->
  <ul id="slide-out" class="sidenav sidenav-fixed">
      <li><a href="#!">First Sidebar Link</a></li>
      <li><a href="#!">Second Sidebar Link</a></li>
      <li class="no-padding">
        <ul class="collapsible collapsible-accordion">
          <li>
            <a class="collapsible-header">Dropdown<i class="material-icons sidenav-dd-expand">arrow_drop_down</i></a>
            <div class="collapsible-body">
              <ul>
                <li><a href="#!" class="waves-effect waves-teal btn-flat">First</a></li>
                <li><a href="#!">Second</a></li>
                <li><a href="#!">Third</a></li>
                <li><a href="#!">Fourth</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </li>
    </ul>
    <!--<ul class="right hide-on-med-and-down">
      <li><a href="#!">First Sidebar Link</a></li>
      <li><a href="#!">Second Sidebar Link</a></li>
      <li><a class="dropdown-trigger" href="#!" data-target="dropdown1">Dropdown<i class="material-icons right">arrow_drop_down</i></a></li>
      <ul id='dropdown1' class='dropdown-content'>
        <li><a href="#!">First</a></li>
        <li><a href="#!">Second</a></li>
        <li><a href="#!">Third</a></li>
        <li><a href="#!">Fourth</a></li>
      </ul>
    </ul>-->
    <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>


  <!--
  ******************************************************************************
          SCRIPT
  ******************************************************************************
  -->


  <script type="text/javascript">

    // Dev Notes to Self
    // Note that document.getElementById("myBtn").addEventListener('click', myFcn)
    // will work when Content-Security-Policy (CSP) does not allow
    // inline event handlers, like if CSP: script-src https://example.com/
    // See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src


    const electron = require('electron');
    const {ipcRenderer} = electron;
    const ul = document.querySelector('ul');

    // From SP EG
    // You can also require other files to run in this process
    const sprend = require('./sprenderer.js')
    const chartRend = require('./chartRend.js')

    // Add item
    ipcRenderer.on('item:add', function(e, item){
      ul.className = 'collection';
      const li = document.createElement('li');
      li.className = 'collection-item';
      const itemText = document.createTextNode(item);
      li.appendChild(itemText);
      ul.appendChild(li);
    });

    // Clear items
    ipcRenderer.on('item:clear', function(){
      ul.innerHTML = '';
      ul.className = '';
    });

    // Remove item on double-click from main  list
    ul.addEventListener('dblclick', removeItem);

    function removeItem(e){
      e.target.remove();
      if(ul.children.length == 0){
        ul.className = '';
      }
    }

    // Serial port -- TODO MOVE & DRY
    function serialSelect(button) {
      var d = document.querySelector("#activePort");
      $('#activeSerialPortStuff').show();
      d.innerHTML = button.name;
    }
    function serialOpen() {
      var d = document.querySelector("#activePort");
      var spname = d.innerHTML;
      sprend.serialOpenByName(spname);
    }
    function serialClose() {
      sprend.serialClose();
    }
    function serialTestWrite() {
      sprend.serialTestWrite();
    }

    // Materialize - sidenav support
    // Without jQuery
    /*document.addEventListener('DOMContentLoaded', function() {
      var options = {};
      var elems = document.querySelectorAll('.sidenav');
      var instances = M.Sidenav.init(elems, options);
    });*/

    // Initialize collapsible (uncomment the lines below if you use the dropdown variation)
    // var collapsibleElem = document.querySelector('.collapsible');
    // var collapsibleInstance = M.Collapsible.init(collapsibleElem, options);

    // Or with jQuery:
    // Materialize inits
    // For both browser and electron app work, this needs the script pre and
    // post load items in the head section to prevent undefined $ or jQuery etc
    //jQuery(document).ready(function($){
    $(document).ready(function(){
    //window.onload = function(){
      $('.sidenav').sidenav();
      $(".dropdown-trigger").dropdown();
      $('.collapsible').collapsible({
        accordion: true
      });
    //}
    });



  </script>

</body>
</html>
